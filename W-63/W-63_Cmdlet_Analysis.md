# W-63: DNS 서비스 동적 업데이트 설정 점검 보고서 (전문가용)

## 스크립트 설명

### 시스템 전제조건
- **서버 역할 및 상태**: 시스템은 Windows Server 운영체제이며, DNS 서버 역할(`dns.exe` 프로세스)이 설치되어 실행 중이어야 합니다. 또한, 서버가 하나 이상의 주 DNS 영역(Standard Primary 또는 Active Directory-Integrated)에 대해 권한을 가지고 있어야 합니다. 캐싱 전용(Caching-only) 서버나 보조(Secondary) DNS 서버는 이 점검의 대상이 아닙니다.

### 탐지 설명
- **공격 원리 및 위협**: DNS 동적 업데이트(RFC 2136) 기능 중 '안전하지 않음(Nonsecure)' 설정은 DNS UPDATE 요청 패킷의 출처를 전혀 인증하지 않습니다. 이는 공격자가 IP 스푸핑 등을 통해 임의의 DNS 레코드를 생성, 수정, 삭제할 수 있게 만듭니다. 예를 들어, 회사 포털의 A 레코드를 피싱 사이트 IP로 변경하여 전 직원의 크리덴셜을 탈취하거나, 메일 서버(MX) 레코드를 변조하여 이메일을 가로챌 수 있습니다. '안전한(Secure)' 업데이트는 Active Directory와 통합된 GSS-TSIG(RFC 3645) 인증을 사용하므로 훨씬 안전하지만, 만약 도메인에 가입된 클라이언트 중 하나가 악성코드에 감염될 경우, 해당 클라이언트의 권한으로 신규 레코드를 등록하여 내부 네트워크의 다른 시스템을 스푸핑하는 데 악용될 수 있습니다. 따라서 최고 수준의 보안이 요구되는 환경에서는 모든 동적 업데이트를 비활성화하여 DNS 데이터의 무결성을 관리자가 전적으로 통제하는 것이 가장 안전합니다.

- **탐지 스크립트 분석**:
  - **명령어**: `Get-DnsServerPrimaryZone`
  - **동작**: 이 명령어는 PowerShell의 `DnsServer` 모듈에 포함된 cmdlet으로, 로컬 DNS 서버 서비스와 직접 통신하여 서버가 권한을 가진 모든 주 DNS 영역의 목록과 속성을 가져옵니다.
  - **의미**: 스크립트는 데이터의 원본이자 수정이 가능한 주 DNS 영역만을 대상으로 점검을 집중합니다. 각 Zone 객체의 `DynamicUpdate` 속성을 검사하는데, 이 속성은 해당 영역의 동적 업데이트 정책을 나타내는 열거형(Enum) 값입니다. 보안 기준인 `None`이 아닐 경우(`Secure` 또는 `NonsecureAndSecure`), 이는 외부 클라이언트에 의한 레코드 변경 가능성이 열려 있음을 의미하므로 취약점으로 진단합니다.

### 수정 설명
- **보안 원리**: 스크립트는 DNS 영역의 데이터 무결성을 보장하기 위해, 클라이언트로부터의 자동 업데이트 요청을 모두 거부하도록 DNS 영역의 정책을 수정합니다. 이를 통해 관리자가 승인한 레코드만 DNS 서비스에 반영되도록 강제합니다.

- **수정 스크립트 분석**:
  - **명령어**: `Set-DnsServerPrimaryZone -Name $zone.ZoneName -DynamicUpdate None`
  - **동작**: 이 cmdlet은 기존에 존재하는 주 DNS 영역의 속성을 수정합니다. `-Name` 파라미터로 수정할 영역을 지정하고, `-DynamicUpdate None` 파라미터와 인자를 통해 해당 영역의 정책을 '동적 업데이트 허용 안 함'으로 변경하도록 DNS 서버에 지시합니다.
  - **의미**: 이 명령어는 PowerShell을 통해 DNS 설정을 변경하는 가장 표준적이고 권장되는 방법입니다. DNS 서버의 설정과 직접 상호작용하여 변경 사항이 즉시 적용되도록 보장하며, 이를 통해 해당 DNS 영역을 동적 업데이트를 악용한 데이터 변조 위협으로부터 보호합니다.

## MITRE ATT&CK TTP Mapping

- **T1565.002 (Transmitted Data Manipulation):** '안전하지 않은' 동적 업데이트는 공격자가 DNS 서버로 전송되는 데이터를 조작하는 공격의 대표적인 예입니다. 공격자는 DNS UPDATE 패킷을 위조하여 DNS 서버에 전송함으로써 정상적인 레코드를 악성 IP로 변경(DNS Hijacking)하거나, 존재하지 않는 서브도메인을 대량 생성하여 DNS 서비스 자체를 마비시키는 공격을 수행할 수 있습니다.
