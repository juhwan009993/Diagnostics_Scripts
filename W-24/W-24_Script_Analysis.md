# W-24: NetBIOS 바인딩 서비스 구동 점검 보고서 (전문가용)

## 스크립트 설명

### 시스템 전제조건
- **운영체제 및 드라이버**: 점검 대상은 `TCPIP.SYS` 드라이버가 로드된 Windows 시스템이어야 합니다. 취약점은 NetBIOS over TCP/IP 서비스(`netbt.sys` 드라이버)가 실행 중일 때 실질적인 위협이 됩니다.
- **네트워크 인터페이스**: 스크립트는 WMI 필터(`IPEnabled = 'TRUE'`)를 통해 IP 주소가 할당된 활성 네트워크 인터페이스만을 대상으로 합니다. 따라서 루프백, 연결이 끊긴 인터페이스 등은 점검 대상에서 제외됩니다.

### 탐지 설명
- **공격 원리 및 위협**: NetBIOS는 본래 라우팅이 불가능한 소규모 LAN 환경을 위해 설계된 브로드캐스트 기반의 프로토콜입니다. 이것이 TCP/IP 상에서 동작(NetBT)하게 되면서 라우팅이 가능해졌지만, 동시에 프로토콜 특유의 "Chatty"(수다스러운) 성질과 취약점이 외부 네트워크에 노출되는 결과를 낳았습니다. 공격자는 UDP/137(이름), UDP/138(데이터그램), TCP/139(세션) 포트를 스캔하여 `nbtstat` 등의 도구로 시스템의 NetBIOS 이름, MAC 주소, 작업 그룹/도메인 정보, 심지어는 Null Session을 통해 사용자 목록까지 획득할 수 있습니다. 이는 공격 초기 단계의 정보 수집(Reconnaissance)에 매우 유용하며, 획득한 정보를 바탕으로 SMB 서비스 무차별 대입 공격이나 제로로그온(Zerologon, CVE-2020-1472)과 같은 치명적인 공격으로 이어질 수 있습니다.

- **탐지 스크립트 분석**:
  - **명령어**: `Get-CimInstance Win32_NetworkAdapterConfiguration -Filter "IPEnabled='TRUE'"`
  - **동작**: 이 PowerShell 명령어는 CIM/WMI 기술을 사용하여 시스템의 `Win32_NetworkAdapterConfiguration` 클래스 인스턴스를 조회합니다. 이 클래스는 네트워크 어댑터의 상세한 IP 구성 정보를 담고 있습니다. `-Filter` 구문은 현재 IP가 할당된 유효한 어댑터만을 필터링하는 역할을 합니다.
  - **의미**: 스크립트는 조회된 각 어댑터 객체의 `TcpipNetbiosOptions` 속성 값에 접근합니다. 이 속성은 특정 네트워크 인터페이스의 NetBIOS over TCP/IP 동작 방식을 제어하는 레지스트리 설정과 직접적으로 매핑되는 값입니다. 이 값을 확인함으로써, 스크립트는 그룹 정책이나 DHCP 설정 등 다양한 변수와 관계없이 현재 시스템에 적용된 실질적인 NetBIOS 상태를 명확하게 판단할 수 있습니다. 보안 기준인 `2`(사용 안 함)가 아닌 다른 값은 모두 보안 편차(Deviation)로 간주합니다.

### 수정 설명
- **보안 원리**: 스크립트는 취약한 네트워크 인터페이스에서 NetBIOS over TCP/IP를 비활성화함으로써, NetBT 기반의 정보 수집 및 공격 시도가 가능한 경로를 원천적으로 차단합니다.

- **수정 스크립트 분석**:
  - **명령어**: `$adapter.Invoke-CimMethod -MethodName SetTcpipNetbios -Arguments @{TcpipNetbiosOptions = 2}`
  - **동작**: 이 명령어는 특정 어댑터를 나타내는 WMI 객체 인스턴스에 대해 `SetTcpipNetbios` 라는 WMI 메서드(Method)를 호출합니다. WMI 메서드는 관리 객체의 상태를 변경하거나 특정 작업을 수행하도록 하는 함수와 같습니다.
  - **의미**: 이 메서드를 호출하는 것은 Microsoft가 공식적으로 지원하는 NetBIOS 설정 변경 방식입니다. 레지스트리를 직접 수정하는 것보다 안전한데, 이는 WMI를 통해 변경할 경우 관련된 서비스나 드라이버에게 설정 변경이 올바르게 통지되기 때문입니다. 스크립트는 정수 `2`를 인자로 전달하여 NetBIOS를 비활성화하며, 이를 통해 해당 인터페이스를 NetBT 관련 위협으로부터 즉시 보호합니다.

## MITRE ATT&CK TTP Mapping

- **T1046 (Network Service Scanning):** 공격자는 외부에 노출된 NetBIOS 서비스를 스캔하여 시스템 이름, 도메인, 서비스 정보를 수집하고, 이를 통해 조직 내부 네트워크 구조를 파악하고 추가 공격 대상을 물색합니다.
- **T1021 (Remote Services):** NetBIOS와 강하게 연관된 SMB 프로토콜은 원격 파일 공유 및 관리의 핵심입니다. NetBIOS를 통해 식별된 SMB 서비스에 대해 무차별 대입 공격이나 알려진 취약점(예: EternalBlue) 공격을 시도하여 원격 코드 실행 권한을 획득할 수 있습니다.
