# W-78: 보안 채널 데이터 디지털 암호화/서명 점검 스크립트 보고서 (상세)

## 스크립트 설명

### 시스템 전제조건
- 점검 대상 시스템은 **Active Directory 도메인에 가입된** Windows Server여야 합니다.
- 이 정책들은 도메인 멤버와 도메인 컨트롤러 간에 생성되는 NetLogon 보안 채널에 적용되므로, 독립 실행형(Standalone) 서버에는 해당되지 않습니다.

### 탐지 설명
- **원리**: NetLogon 보안 채널은 도메인 멤버(서버, 클라이언트)가 도메인 컨트롤러와 통신하며 컴퓨터 인증, 계정 정보 조회 등 민감한 작업을 수행하는 통로입니다. 만약 이 채널을 통해 전송되는 데이터가 암호화되거나 서명되지 않으면, 공격자는 네트워크 상에서 트래픽을 가로채(Sniffing) 내용을 엿보거나, 중간자 공격(MitM)을 통해 데이터를 조작하여 인증을 우회하거나 권한을 탈취할 수 있습니다. 따라서 보안 채널의 기밀성과 무결성을 보장하는 것은 도메인 보안의 핵심 요소입니다.
- **탐지 방식**: 스크립트는 레지스트리 편집기(`regedit`)를 통해 다음 경로의 세 가지 `REG_DWORD` 값을 직접 확인합니다.
  - 경로: `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa`
  - 값:
    1.  `RequireSignOrSeal`: 보안 채널 데이터 디지털 암호화 또는 서명 (항상)
    2.  `SealSecureChannel`: 보안 채널 데이터 디지털 암호화 (가능한 경우)
    3.  `SignSecureChannel`: 보안 채널 데이터 디지털 서명 (가능한 경우)
- 가장 강력한 보안을 위해서는 세 정책 모두 '사용(Enabled)' 상태, 즉 레지스트리 값이 `1`이어야 합니다. 스크립트는 이 값들 중 하나라도 `1`이 아니거나 존재하지 않을 경우, 시스템을 '취약' 상태로 진단합니다.

### 수정 설명
- **원리**: 스크립트는 NetLogon 보안 채널의 보안 수준을 강화하기 위해, 데이터 암호화 및 서명을 강제하는 정책을 프로그래밍 방식으로 활성화합니다. 이를 통해 해당 서버가 도메인 컨트롤러와 항상 안전한 채널만 설정하도록 보장합니다.
- **수정 방식**: '취약'으로 진단된 정책에 대해, 스크립트는 `Set-ItemProperty` cmdlet을 사용하여 해당 레지스트리 값(`RequireSignOrSeal`, `SealSecureChannel`, `SignSecureChannel`)을 `1`로 설정(또는 생성)합니다. 이 작업은 로컬 보안 정책에서 해당 항목들을 '사용'으로 설정하는 것과 동일한 효과를 가집니다. 조치 후, 스크립트는 다시 레지스트리 값을 읽어 변경 사항이 올바르게 적용되었는지 검증하고 최종 조치 결과를 판단합니다.

## MITRE ATT&CK TTP Mapping

이 취약점은 도메인 환경의 핵심 인증 채널을 공격하는 데 사용될 수 있으며, 다음 MITRE ATT&CK 기술과 관련됩니다.

- **T1557 (Adversary-in-the-Middle):** 보안 채널이 보호되지 않을 경우, 공격자는 ARP 스푸핑, DNS 스푸핑 등의 기법으로 서버와 도메인 컨트롤러 사이에 위치하여 NetLogon 트래픽을 가로챌 수 있습니다. 이를 통해 인증 정보를 탈취하거나 조작하여 정상적인 사용자로 위장할 수 있습니다.
- **T1071 (Application Layer Protocol):** NetLogon은 Windows 인증의 핵심적인 응용 계층 프로토콜입니다. 암호화/서명이 적용되지 않은 트래픽을 공격자가 수집하고 분석하여 도메인 구조, 계정 정보 등 민감한 정보를 획득하고, 이를 기반으로 더 정교한 공격(예: Pass-the-Hash)을 준비하는 데 사용할 수 있습니다.
